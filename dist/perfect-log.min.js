!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.PerfectLog=t()}(this,function(){"use strict";var e=function(e,t,r){return console[e].bind(window.console,"%c["+t+"]%c","color: "+r,"color:black")},t=e("log","DEBUG","green"),r=e("info","INFO","blue"),o=e("error","ERROR","red"),n=function(){},i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},l=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),a={DEBUG:{level:1,color:"green"},INFO:{level:2,color:"blue"},ERROR:{level:3,color:"red"}},s=function(){function e(t,r,o){if(i(this,e),!a[t])throw new Error;this.levelText=t,this.level=r||a[t].level,this.color=o||a[t].color}return l(e,[{key:"greaterThan",value:function(e){return this.level>=e.level}}]),e}(),u=new s("DEBUG",a.DEBUG.level,a.DEBUG.color),p=new s("INFO",a.INFO.level,a.INFO.color),c=new s("ERROR",a.ERROR.level,a.ERROR.color),f=void 0,h=void 0,v=void 0,d=function(){function e(){i(this,e)}return l(e,null,[{key:"initialize",value:function(){this.enableConsoleOutput(),this.disableReport(),this.reportOptions={}}},{key:"enableReport",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.reportOptions=Object.assign({level:"ERROR",data:null},t),this.reportOptions.url){var r=void 0;try{r=new s(this.reportOptions.level),this.reportEnabled=!0}catch(e){console.error("Invalid level option. Only ERROR/INFO/DEBUG are allowed.")}var o=function(){return!e.reportOptions.sample||("number"==typeof e.reportOptions.sample?Math.random()>e.reportOptions.sample:"function"==typeof e.reportOptions.sample?e.reportOptions.sample():void 0)};this.debug=function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];if(f.apply(void 0,n),o()&&u.greaterThan(r)){var l=e._buildReportScheme(u,e._buildReportMsg(n));e._report(l)}},this.info=function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];if(h.apply(void 0,n),o()&&p.greaterThan(r)){var l=e._buildReportScheme(p,e._buildReportMsg(n));e._report(l)}},this.error=function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];if(v.apply(void 0,n),o()&&c.greaterThan(r)){var l=void 0;l=1===n.length&&n[0]instanceof Error?e._buildReportScheme(c,"",n[0]):e._buildReportScheme(c,e._buildReportMsg(n)),e._report(l)}}}else console.error("You must provide a url when enabling report service.")}},{key:"disableReport",value:function(){this.reportEnabled=!1,this.debug=f,this.info=h,this.error=v}},{key:"enableConsoleOutput",value:function(){this.consoleOutput=!0,f=t,h=r,v=o,this.reportEnabled||this._resetWrapper()}},{key:"disableConsoleOutput",value:function(){this.consoleOutput=!1,f=h=v=n,this.reportEnabled||this._resetWrapper()}},{key:"patchData",value:function(e,t){var r={};e&&t&&("string"==typeof e||e instanceof String)?r[e]=t:e&&e instanceof Object&&(r=e),this.reportOptions.data=Object.assign({},this.reportOptions.data,r)}},{key:"_buildReportScheme",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return{level:e.levelText,msg:t,error:r,time:(new Date).toISOString(),data:this.reportOptions.data,platform:{browser:navigator.userAgent}}}},{key:"_report",value:function(e){var t=new XMLHttpRequest;t.open("POST",this.reportOptions.url,!0);var r=e;this.reportOptions.beforeSend&&this.reportOptions.beforeSend instanceof Function&&(r=this.reportOptions.beforeSend(e)),t.send(JSON.stringify(r))}},{key:"_buildReportMsg",value:function(e){return e.map(function(e){return JSON.stringify(e)}).join(", ")}},{key:"_resetWrapper",value:function(){this.debug=f,this.info=h,this.error=v}}]),e}();return d.initialize(),d});
